# Prototype

- Используется, когда мы хотим скопировать уже существующий объект, а не создавать его с нуля. Например, префаб в юнити. То есть прототип, который будет клонирован, обычно уже прошел дорогую процедуру настройки и мы не хотим повторять ее
- Для прототипов нужно глубокое копирование
- [MemberviseClone](https://learn.microsoft.com/ru-ru/dotnet/api/system.object.memberwiseclone?view=net-8.0) выполняет не глубокое копирование
- Есть интерфейс ICloneable. Его проблема в том, что это контракт от майкрософта, и в документации написано, что 
> *ICloneable does not specify whether the cloning operation performs a deep copy, a shallow copy, or something in between. we recommend that [ICloneable](https://learn.microsoft.com/en-us/dotnet/api/system.icloneable?view=net-8.0) not be implemented in public APIs.* 

  Это значит, что если человек, который пользуется нашим кодом, столкнется с ICloneable, и вызовет метод Clone(), то он не будет знать, какого поведения ожидать - глубокого копирования или поверхностного. Поэтому для прототипа этот интерфейс точно не подходит
- Есть подход с копирующим конструктором. Его проблема в том, что нужно на каждый тип будет писать копирующий конструктор. Более того, если много эдж кейсов. Например инициализация полей перед копированием, или если один из вложенных классов должен создаваться фабрикой, или создаваться асинхронно. В общем - тоже очень не масштабируемый подход
  
~~~
public Address(Address other) //Copying constructor
{    
StreetAddress = other.StreetAddress;    
City = other.City;    
Country = other.Country;
}
~~~
- Для глубокой копии можно использовать сериализаторы. То есть брать объект, сериализовывать его в озу, после сразу десереализовывать в новый экземпляр. Фишка в том, что сериализаторы хорошо умеют выполнять глубокое копирование во время сериализации, поэтому не придется писать самим. Из минусов - дороговизна по ресурсам и эдж кейсы по типу XML и Dictionary или если поля будут помечены как NonSerializable или в таком духе
- Хороший подход это совместить фабрику и прототип. В фабрике лежат прототипы(уже созданные объекты), а создание их копий выведено в виде API класса фабрики
